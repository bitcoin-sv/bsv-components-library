package io.bitcoinsv.bsvcl.net.unit.protocol.serialization


import io.bitcoinsv.bsvcl.tools.bytes.ByteArrayReader
import io.bitcoinsv.bsvcl.tools.bytes.ByteArrayWriter
import io.bitcoinsv.bitcoinjsv.core.Sha256Hash
import io.bitcoinsv.bitcoinjsv.params.MainNetParams
import io.bitcoinsv.bitcoinjsv.params.Net
import org.spongycastle.util.encoders.Hex
import spock.lang.Specification

/**
 * @author m.fletcher@nchain.com
 * Copyright (c) 2018-2019 Bitcoin Association
 * Distributed under the Open BSV software license, see the accompanying file LICENSE.
 *
 * @date 07/10/2019
 *
 * Testing class for the DsDetect message Serialization.
 * The test is taken the assumption that we have already a correct serialization version of this Message, obtained
 * from another source that we trust (in this case bitcoind). So we serialize/deserialize some
 * messages with out code and compare the results with that reference.
 */
class DsDetectSerializerSpec extends Specification {

    // Body Message in Hex Format:
    public static final String SERIALIZED_DSDETECT_MSG ="0100051801000000f6fd6bf2dbb876135ed18429ce2ca343c65364b73a8bf22da9c203a0ed54f80e116c42adf62f1b131cd79b9b32c155a9814b2d757d27f76bf746a739b8b8e5d6f4e5494dffff7f2002000000010000004f44faccf1d1db49ab6049b3ee61dcc41516c492c248196fa9be6108a202812fdcdaf8696db794f808047f0dfe0f0403c86ceadc4947ee4f214fa628c76cdc4af3e5494dffff7f200000000001000000b960959cd288acd89d3bc0c54644077fe1d5ae53f69534e74e9dd1920620df25f272629875927759891e8d1c6d5b8494eb1714d7dccc2f442dea3b540b78836af2e5494dffff7f200500000001000000d9d936b4cbcc773029b74dbf51f4f69dc5a17821bf18d9a57110b751b129a27977a910f2ace9bc5e06db0173585a2cca77258ad30d42881b4fcb1caed4275458f1e5494dffff7f2001000000010000004f9297187c38f3e6a62ca9a4bc672190ff8cc7a4b40f85bb14d6fc12ac489d419630d9a953fd360de5881c8bbfa408cc450ff2c96c7527c58e7ad7c62270ee53f0e5494dffff7f200000000001000000f03bf5e08e3b338194c0285d305242cd692f12052357a001039d41de8f11305d04a5449ed93fc7e1d385cef7f36ad579de85b915bc23f6874051c5707408febfefe5494dffff7f20000000000100000030c88c54f3935820cec5c86593c519b1f1219639a6b224d17e04369d26305c4caa4afb65e8bf7f6d818ee9c7652fdbd038ed67111b4ed5fe9c0166a0bcfc99bbeee5494dffff7f200000000001000000f0630be2a2d31490ade73ec876e942f86fb3e5cdfe58ff8e15e4f2555327ea17ea6ca5afa9315d8bb3cf58ac9ec32e349a647a7a985b3dac257767c459b99f0eede5494dffff7f200000000001000000be85a8731f49c29d6437c4d01f628a805c3b3848e8a78bb9234e8cefc7ff0a133893701bfa2d8079de56eb90a885ec5c8efefc4737f1c096f49601dff2cff6bfece5494dffff7f200000000001000000e63eac30865b24c3dfb76d530926307d6ad572bb3f97c547f252891313c8453461a195fe5c7e8114bee6f203cf7df138339e94139cda895370f1a9b064f6da99ebe5494dffff7f2000000000010000006c22f091579826cf2ecea3154bea60a26d1485d285cf3b56e0e3d0344e858d388b21fe1271608b6dca9d8c69f8b503a7fefb6e98b8f6a015b627349bee9aa6dfeae5494dffff7f200000000001000000dcdc43ba165c2baef6fb07800448d5181c783da2857da4780dc004c0edfd1c7d1d23e9f9304702e6e2b84cb35686c68e7daa05ec94fb1ff28dcb88d1a45a05f4e9e5494dffff7f200000000001000000eac6fc55edc56703447c7dfe09595309d8d00c7432ed1ca1b73efc5276a3f733bc1f95c3d9aae3966a4e60e5fff8160f7275418915724ab818e3ef9b51530561e8e5494dffff7f200200000001000000f4213c6f41ecf667f3af916602c28cd45af32a377d31c5fcafac0f79af2b73190e62ae0e49d97be9d45a7534411b5f4b4db0448af1ed4bd911f26511fbce3e2ce7e5494dffff7f200100000001000000ce51efefc2ce805b1cbcb39e02ecc31a9b39a39583ca273d0da64ee850989865b3b27f8c7a35ce92ed157f3ea9a648a6ec818736c441adbd20f4396c6bdb4c84e6e5494dffff7f20000000000100000099cd2a810e371f025b56982cbf0983f63f7f4fd0ac8964af407295a7e40e70311fb201733748656e19be3c52e06cb99ef000e9a6e2095ba946a126982e849767e5e5494dffff7f2002000000010000001f52f9a0fc889c3fedd500b40b9298a965a232aedf96463676f51038856d13338d04527dfd3123bd6da72da36b4e341f9785ce5ae75807b5269c56da81348ed4e4e5494dffff7f2003000000010000006e19c69f48639e9ec211d1a7d4577f6ef62bf0c7a90a7a73362df61f0bfa5335d052770beecb599038ec2c4f6b917d9f66904dc4eaa374f87c7427c61cce3b51e3e5494dffff7f2000000000010000002e4b6c56a4833877c897b84993612f435f3593d46bcc6508d5648f724b00736ee641ea29c3d2f02cff968081979566c80c6a3e389f1441422b88ae60d908ae9ae2e5494dffff7f2000000000010000003c65ae135ea43402b69ac5774ab263cce2ccdcc82ab312f4e6288319e376831f8d294b25f52a4a80b36711b40303ea90de59ee2f266859647fb1ba13ac046475e1e5494dffff7f200000000001000000a9173399d119d0851a5d99b8c3ea5de2ce243a3dfcc2658c6b2c72c62ee295549d319939f1dfa32027ec77b6614b60898a9580a64d1f8e56b8f0e2ad7b4be643e0e5494dffff7f2000000000010000008a128401c3d51e5af0c627b6ccbe94a0ead2388318ce9149374df8b9ccfd0736d650032988725f17c5969250fde4aa5658c25f591e9cfd7fe0257de7112267cedfe5494dffff7f2000000000010000001dbf68c40dff74fb3761e36cf79d53be5f2dd8d71d7c885bd3d9ef387a5f5e3b5572cd3be19133a65481a57a4259c98659a6489738b7fcff5c66efb1e50d9708dee5494dffff7f2001000000010000003dc5b90dc6af423b7dfc3702f748d08fcad04f5cceb3b063699d454ef319e74169417620318fc1b01ed7850407373a8763fa86ae16c110114cd631543cc2035fdde5494dffff7f200600000005013d01000000014f993ee9eb84c0fd6fd840756a341d0a7e0a87259c96e4a86de23cba6dbad1ab2800000000ffffffff01d590f70400000000015100000000116c42adf62f1b131cd79b9b32c155a9814b2d757d27f76bf746a739b8b8e5d60100955b535eff900431c5cdb1300b9132e7990d9e949125a40b66e29090432294860701000000df202ade5ac4089dabbbbc46db91f901139c4b8bb67976fdc5611428e5ce8d3a912fec76519c4472234f7ea2055fa7738dd9d1b4606f16d80ef4f5b38eedb697fbe5494dffff7f2001000000010000006311ea3b1e95107ad107981d0d999dfae9fb3fb8918f3026e462882079856120e641ea29c3d2f02cff968081979566c80c6a3e389f1441422b88ae60d908ae9afae5494dffff7f2003000000010000005d8270deb49102421e90573e9c4ece436efe3cbe9dad53f5335ebf4cac8096798d294b25f52a4a80b36711b40303ea90de59ee2f266859647fb1ba13ac046475f9e5494dffff7f200500000001000000d517326fe081918015e371c1329a9b6af81a4f622e498c0bb4e10bd06b68ad379d319939f1dfa32027ec77b6614b60898a9580a64d1f8e56b8f0e2ad7b4be643f8e5494dffff7f20000000000100000034de19bf3762955abc699e490bef1d71fc4e1fbb985c07c980a4b4854493780fd650032988725f17c5969250fde4aa5658c25f591e9cfd7fe0257de7112267cef7e5494dffff7f200000000001000000b08bce6a840e5005d7924e512a1263a4f8644e5631e6b484fb5bbb0a32478d5b5572cd3be19133a65481a57a4259c98659a6489738b7fcff5c66efb1e50d9708f6e5494dffff7f2000000000010000003dc5b90dc6af423b7dfc3702f748d08fcad04f5cceb3b063699d454ef319e74169417620318fc1b01ed7850407373a8763fa86ae16c110114cd631543cc2035ff5e5494dffff7f200100000005013d01000000014f993ee9eb84c0fd6fd840756a341d0a7e0a87259c96e4a86de23cba6dbad1ab2800000000ffffffff01aa40f90300000000015100000000912fec76519c4472234f7ea2055fa7738dd9d1b4606f16d80ef4f5b38eedb6970100d052770beecb599038ec2c4f6b917d9f66904dc4eaa374f87c7427c61cce3b511801000000bc416821665dc8b73d120cad3fc54f6f69bca5d3909d82a1a6ef6eb774fa57761db7e0657f097ff7e5425a9ddbc11593bd20f925c909fd74e1733a6f12f6916e0de6494dffff7f200200000001000000ca50287ff4e55cd0017b83b5e6fb5d00c53de0b18199e58db3ccba61caa82c59dcdaf8696db794f808047f0dfe0f0403c86ceadc4947ee4f214fa628c76cdc4a0ce6494dffff7f2000000000010000009022c95c99811394d651a18d67858ab57389318925102de01c084f3cb7e8c517f272629875927759891e8d1c6d5b8494eb1714d7dccc2f442dea3b540b78836a0be6494dffff7f20010000000100000067107016f64e78ba488229133995ea4b2c74236b08f442a6038ed7e8c29a903877a910f2ace9bc5e06db0173585a2cca77258ad30d42881b4fcb1caed42754580ae6494dffff7f200000000001000000bb75678f82abcb83892db98063ef18346024941aadb5147718c881477c7f7e1c9630d9a953fd360de5881c8bbfa408cc450ff2c96c7527c58e7ad7c62270ee5309e6494dffff7f2003000000010000008618c57e78a2f744f37c0c13f8dafa5a3fc54f0354be305edfdccabad13df22b04a5449ed93fc7e1d385cef7f36ad579de85b915bc23f6874051c5707408febf08e6494dffff7f20000000000100000099defe26bb6d25298357bf9d251dfcfa8bbe1747932772f78e2248258cd00d45aa4afb65e8bf7f6d818ee9c7652fdbd038ed67111b4ed5fe9c0166a0bcfc99bb07e6494dffff7f2000000000010000005cc06f6a3fd0779dff3489b4271d58eaaacc1bd7ee7809ab0b91585454bc600bea6ca5afa9315d8bb3cf58ac9ec32e349a647a7a985b3dac257767c459b99f0e06e6494dffff7f20000000000100000082e48d9f52beaa64ef40a2901dbedb5b10e0afe8d6240c8f42ea3bde80957a643893701bfa2d8079de56eb90a885ec5c8efefc4737f1c096f49601dff2cff6bf05e6494dffff7f20040000000100000078cbeaedc7c7b544315ebf52727234db2eac12fdea5811c4ac828ed9c659aa1461a195fe5c7e8114bee6f203cf7df138339e94139cda895370f1a9b064f6da9904e6494dffff7f200000000001000000095f6187d580366f19fe76309a7143c74faaa5466c109f33c54d88b2a23090338b21fe1271608b6dca9d8c69f8b503a7fefb6e98b8f6a015b627349bee9aa6df03e6494dffff7f200200000001000000f1073f967c06fc0ea72cb2a1f8f6490c3244d4aaee9cc06c9c195436b3e3c51b1d23e9f9304702e6e2b84cb35686c68e7daa05ec94fb1ff28dcb88d1a45a05f402e6494dffff7f200100000001000000ffbeeb3ad61ae1a6f8f4c60d364b26b9f261960f968a986d074ec56535b4d00cbc1f95c3d9aae3966a4e60e5fff8160f7275418915724ab818e3ef9b5153056101e6494dffff7f20040000000100000071667893ba089982454e0ca7a0c1c18e1d47af977adf9fcb2c351fc79992a3430e62ae0e49d97be9d45a7534411b5f4b4db0448af1ed4bd911f26511fbce3e2c00e6494dffff7f2000000000010000007675b5613c4fdfbb5203ace516e2b150ac54991644b71cb2e64761ba3ea48c2bb3b27f8c7a35ce92ed157f3ea9a648a6ec818736c441adbd20f4396c6bdb4c84ffe5494dffff7f200200000001000000c8a36019822aa4fee6caca754b5a424f34dd348efb13d775e2e83731e1acb5571fb201733748656e19be3c52e06cb99ef000e9a6e2095ba946a126982e849767fee5494dffff7f2002000000010000007301e977024c1c9f13a9180cb65d0f76378dbdb2cf499a3bcf65e2aa1579a05c8d04527dfd3123bd6da72da36b4e341f9785ce5ae75807b5269c56da81348ed4fde5494dffff7f200000000001000000df202ade5ac4089dabbbbc46db91f901139c4b8bb67976fdc5611428e5ce8d3ad052770beecb599038ec2c4f6b917d9f66904dc4eaa374f87c7427c61cce3b51fce5494dffff7f2000000000010000006311ea3b1e95107ad107981d0d999dfae9fb3fb8918f3026e462882079856120e641ea29c3d2f02cff968081979566c80c6a3e389f1441422b88ae60d908ae9afae5494dffff7f2003000000010000005d8270deb49102421e90573e9c4ece436efe3cbe9dad53f5335ebf4cac8096798d294b25f52a4a80b36711b40303ea90de59ee2f266859647fb1ba13ac046475f9e5494dffff7f200500000001000000d517326fe081918015e371c1329a9b6af81a4f622e498c0bb4e10bd06b68ad379d319939f1dfa32027ec77b6614b60898a9580a64d1f8e56b8f0e2ad7b4be643f8e5494dffff7f20000000000100000034de19bf3762955abc699e490bef1d71fc4e1fbb985c07c980a4b4854493780fd650032988725f17c5969250fde4aa5658c25f591e9cfd7fe0257de7112267cef7e5494dffff7f200000000001000000b08bce6a840e5005d7924e512a1263a4f8644e5631e6b484fb5bbb0a32478d5b5572cd3be19133a65481a57a4259c98659a6489738b7fcff5c66efb1e50d9708f6e5494dffff7f2000000000010000003dc5b90dc6af423b7dfc3702f748d08fcad04f5cceb3b063699d454ef319e74169417620318fc1b01ed7850407373a8763fa86ae16c110114cd631543cc2035ff5e5494dffff7f200100000005013d01000000014f993ee9eb84c0fd6fd840756a341d0a7e0a87259c96e4a86de23cba6dbad1ab2800000000ffffffff0180f0fa02000000000151000000001db7e0657f097ff7e5425a9ddbc11593bd20f925c909fd74e1733a6f12f6916e0100955b535eff900431c5cdb1300b9132e7990d9e949125a40b66e29090432294862a010000000e35cead365772487d35fb9b6298d75dbf1525095a85500c0e1b65c9d515136b63abfbfae5af5f4cb96fb3c13809e554526b27dab0c547c9b60b87a86c86322427e6494dffff7f2002000000010000005d89d1dc6a22fccf582f88ca5b410947f7bbf33208aefcc1f574ee40a3a9867876b03586cfab69c022576b01874ec6ac489f9efd33efa45abdc54906445ce26c26e6494dffff7f2000000000010000003a1910ec082b29ab956e04f8bae4b9ecff677c37559c77dcc20481ccdbac2a335a3106bad51612115f50b36eba74df8705d45b34e76dca70742d96e5f1041c1d25e6494dffff7f20000000000100000012562ed242331da160f03dedb736084919cbaef0f32d012fe47e3b1744e6d6760b34487c6b1ae1038e1fc181c63b1973b1103d42f7c6fb4857325a6bcaeac8f624e6494dffff7f20000000000100000022ef82cf7447ef949d898b9dfb1c370f93e3f8fe008018983ce920dc46e4d255e6aab372d6287fddf1db2cc57728338cdedd67bf2918c887e5715ea411ee4a4823e6494dffff7f200000000001000000927b4553440f389d484b336a27c52942c0c39d3b09cf04d47ac879cc656ffa410eb6422c27adfd04f91b674e63c3c664d0039dd9d53f33ff5b16f8e0b5f1a9ff22e6494dffff7f20000000000100000078c2a2b7797bc658c7b17be5733caa673519b30dcb185fa4cbd70de1e5b4003e0b16e0c889dbf2c589facf9979955e60e502867c85c7b9a4aed0d33a6822961721e6494dffff7f200300000001000000000502dda5c84fea9a0b18df5125cf58d06dce8933e2f98ba4a9522d92c4cb72b1d02469882cb3369a902df98b2b5c482c7b21228174bb3a7679c140c53aca7320e6494dffff7f200000000001000000cddbc1f6e4af8dd76acaabd70d6bc41a5f8f007eb9d25ae79545ccefb7c9607d65476eacfae3d53ea5b62e6232291dbff9fc7ca6e36c4414c8ac5dc1f2b494191fe6494dffff7f200000000001000000ddd5ea6c413e3cbeec5f943af411bfa7360b305937a12764524520b86a0c255ff83d8241e718fa6281ece91aeee0617e0063201b677dde5374fb6bea9235d8cc1ee6494dffff7f20010000000100000074a6e4a42958967ed427bd3df5812a80234d4bb4786653c74ab77288a94082044b90f3d42582a68a8e84aa793511559b83d6c3ea325db810313038ed97df09c21de6494dffff7f200000000001000000fc93610d373a7bc973ed808ec2126e48efb8bc44e0d7cc87b8227166ce6ba0533b584fb59293d8fee15384b1210e8c335626b959fc159d378b401afbefaef3ef1ce6494dffff7f200000000001000000a1aab9417834854bbbaf279e01ca24faf41aec562833fbbf36e391190fc6b73a5d0fcba2ca3732271629ea7451b53f5d4a96f833c44cd8a3d5501e471f51ab7d1be6494dffff7f200000000001000000d35ce84c8d77d179a8f7793ae2f7773596d5c34379d3635ae8503012148fff54a2401461d25e22b26daeedfd81550e90c8a961029c1f97ca9f158a384ad7abbf1ae6494dffff7f200100000001000000ebb127d82edbb2469d0b88f6e7a75fea4ad0d3fb5735e4b23d4c69163d11194b72fb8c5f36cb53ca6702da7fe78a68e96de768b4915f796b3cef818c9e96a7ae19e6494dffff7f2001000000010000000875c71eaec5a117a640d3134900988df5927d63bbf49f8fbad4f72a40150f34ff28d6681d41ccc1be736703a1dda81e44a5ce791046169772251f5dc581ee8318e6494dffff7f2000000000010000005b9ec09c7698587c852aa48168572ad0eda051c4da152cddb5b7c78507eb9c0f014190efad88bbfb72e64fd0126edeb6f81a1ecc1acd8c74a06d9124f68bd64d17e6494dffff7f200000000001000000baa131efaa14bdfc4f0e6b794fa5a9cfcb88c9abd4dcc7e107e6347f0b49ae6400b5d285c9f55051aca41883db2a13d51c38cc4fe4e364ccf8909094c1e0b62316e6494dffff7f2000000000010000009a104796ff4617efbc515c94fbfc4cbea77ef1dcedbb0d9888934aa67e53da3d955b535eff900431c5cdb1300b9132e7990d9e949125a40b66e290904322948615e6494dffff7f20020000000100000055fe4148196d1322a16016b822ce49219fbe18302fbd8cc543a5d217450e8070dcdaf8696db794f808047f0dfe0f0403c86ceadc4947ee4f214fa628c76cdc4a14e6494dffff7f2001000000010000009b2cffe21d955bf55e492cc6d19a737c5ca3901f98684d9b87289f2514a5d330f272629875927759891e8d1c6d5b8494eb1714d7dccc2f442dea3b540b78836a13e6494dffff7f2000000000010000004957fc8f049f2a3875aa48d0abc1195131374987db021b0ab9bcefdb8d54881a77a910f2ace9bc5e06db0173585a2cca77258ad30d42881b4fcb1caed427545812e6494dffff7f200100000001000000e44d81449f6838da3c7772f1d0ee3826e3d14829436c9a44a295cb04f4d984419630d9a953fd360de5881c8bbfa408cc450ff2c96c7527c58e7ad7c62270ee5311e6494dffff7f200000000001000000d9a1cdc4ca3a2e36dff858f3c179711dbf9ca704efa64b6c0012ec3c54d0f22204a5449ed93fc7e1d385cef7f36ad579de85b915bc23f6874051c5707408febf10e6494dffff7f2000000000010000006b91ff6ae4e8c633b1f64814b30ac97c7c69f21c6760fe46aa5263cf2a951b17aa4afb65e8bf7f6d818ee9c7652fdbd038ed67111b4ed5fe9c0166a0bcfc99bb0fe6494dffff7f2005000000010000005cc06f6a3fd0779dff3489b4271d58eaaacc1bd7ee7809ab0b91585454bc600bea6ca5afa9315d8bb3cf58ac9ec32e349a647a7a985b3dac257767c459b99f0e0ee6494dffff7f20000000000100000082e48d9f52beaa64ef40a2901dbedb5b10e0afe8d6240c8f42ea3bde80957a643893701bfa2d8079de56eb90a885ec5c8efefc4737f1c096f49601dff2cff6bf05e6494dffff7f20040000000100000078cbeaedc7c7b544315ebf52727234db2eac12fdea5811c4ac828ed9c659aa1461a195fe5c7e8114bee6f203cf7df138339e94139cda895370f1a9b064f6da9904e6494dffff7f200000000001000000095f6187d580366f19fe76309a7143c74faaa5466c109f33c54d88b2a23090338b21fe1271608b6dca9d8c69f8b503a7fefb6e98b8f6a015b627349bee9aa6df03e6494dffff7f200200000001000000f1073f967c06fc0ea72cb2a1f8f6490c3244d4aaee9cc06c9c195436b3e3c51b1d23e9f9304702e6e2b84cb35686c68e7daa05ec94fb1ff28dcb88d1a45a05f402e6494dffff7f200100000001000000ffbeeb3ad61ae1a6f8f4c60d364b26b9f261960f968a986d074ec56535b4d00cbc1f95c3d9aae3966a4e60e5fff8160f7275418915724ab818e3ef9b5153056101e6494dffff7f20040000000100000071667893ba089982454e0ca7a0c1c18e1d47af977adf9fcb2c351fc79992a3430e62ae0e49d97be9d45a7534411b5f4b4db0448af1ed4bd911f26511fbce3e2c00e6494dffff7f2000000000010000007675b5613c4fdfbb5203ace516e2b150ac54991644b71cb2e64761ba3ea48c2bb3b27f8c7a35ce92ed157f3ea9a648a6ec818736c441adbd20f4396c6bdb4c84ffe5494dffff7f200200000001000000c8a36019822aa4fee6caca754b5a424f34dd348efb13d775e2e83731e1acb5571fb201733748656e19be3c52e06cb99ef000e9a6e2095ba946a126982e849767fee5494dffff7f2002000000010000007301e977024c1c9f13a9180cb65d0f76378dbdb2cf499a3bcf65e2aa1579a05c8d04527dfd3123bd6da72da36b4e341f9785ce5ae75807b5269c56da81348ed4fde5494dffff7f200000000001000000df202ade5ac4089dabbbbc46db91f901139c4b8bb67976fdc5611428e5ce8d3ad052770beecb599038ec2c4f6b917d9f66904dc4eaa374f87c7427c61cce3b51fce5494dffff7f2000000000010000006311ea3b1e95107ad107981d0d999dfae9fb3fb8918f3026e462882079856120e641ea29c3d2f02cff968081979566c80c6a3e389f1441422b88ae60d908ae9afae5494dffff7f2003000000010000005d8270deb49102421e90573e9c4ece436efe3cbe9dad53f5335ebf4cac8096798d294b25f52a4a80b36711b40303ea90de59ee2f266859647fb1ba13ac046475f9e5494dffff7f200500000001000000d517326fe081918015e371c1329a9b6af81a4f622e498c0bb4e10bd06b68ad379d319939f1dfa32027ec77b6614b60898a9580a64d1f8e56b8f0e2ad7b4be643f8e5494dffff7f20000000000100000034de19bf3762955abc699e490bef1d71fc4e1fbb985c07c980a4b4854493780fd650032988725f17c5969250fde4aa5658c25f591e9cfd7fe0257de7112267cef7e5494dffff7f200000000001000000b08bce6a840e5005d7924e512a1263a4f8644e5631e6b484fb5bbb0a32478d5b5572cd3be19133a65481a57a4259c98659a6489738b7fcff5c66efb1e50d9708f6e5494dffff7f2000000000010000003dc5b90dc6af423b7dfc3702f748d08fcad04f5cceb3b063699d454ef319e74169417620318fc1b01ed7850407373a8763fa86ae16c110114cd631543cc2035ff5e5494dffff7f200100000005013d01000000014f993ee9eb84c0fd6fd840756a341d0a7e0a87259c96e4a86de23cba6dbad1ab2800000000ffffffff0155a0fc010000000001510000000063abfbfae5af5f4cb96fb3c13809e554526b27dab0c547c9b60b87a86c86322401002c6cae95bd68d3cf11eab69904adf775095868701cca6782331b5a61fe415b793101000000f0721d4fcec66f41ada98e6f93c4fbe58d1370a5b35c85a0b003dd7e425f2128ef3a0024315a228a680f3a46fa75f3c6a7ad42de9881deb7f9d269c001a0d38e44e6494dffff7f20010000000100000057442ca333a15f1c5ce5f730bbecf479220c85808c3782c34c4b0fa269dc3976e3a2d3dc6dc356d7b173e9df996b0b4d891667f94678607ccbd045ec6bfceb4743e6494dffff7f2000000000010000008badf41a6f6d8491fa6a4fb682f01dd114d2e836b5a676067c594754150b5865e405d8899c87de51b430ea70062a4b3ba480a4f3f81a8084a7a41602f9715e5742e6494dffff7f200000000001000000f75da2346b59eb5663b9e97747f06e2173e3a5bbcc7627eed96685fed4a7cd59c3f59bcf057d5a5eb9d96010df24b5b11495c34d456483895f934d8f1248bc4741e6494dffff7f200000000001000000db88db2b96612b8bfe5a72b48f8cc4ede0d771be3d4689a4a93cb849371c691ce784a29070e27dd3e5c7ae93b50f81567076eeb24d949e64be3ae5085f94f2d440e6494dffff7f200200000001000000bba632bebdbc86d22d6df8fc43131729d1ca93685b7f92f04ed2d1973fb7a1532d46971b9576373a809870824d35c2f9ecba71369a327a2d6c82c175aa50f2523fe6494dffff7f200000000001000000bc72b5e5318ce86c8c9ac2d33e49edfd2f7acae8916d09d0a7966712279c99625ddce376dad90190ea7c5bbbeb37e28c32bca7dbc5d24fedb27cb3cb7d2b10e93ee6494dffff7f200000000001000000a832ef5ffaf8cd98631b0c46ed921a5e0d2679e1c95c067c7ac6f569461583452c6cae95bd68d3cf11eab69904adf775095868701cca6782331b5a61fe415b793de6494dffff7f2003000000010000006b37892c1eed408521e0a20b98c6d70aaf1a51c4b04e26e3924698cbda17577b76b03586cfab69c022576b01874ec6ac489f9efd33efa45abdc54906445ce26c3ce6494dffff7f20020000000100000092480e861c6a8e47f6294f560020a411cc15b41b8381d0e05aba6abc3bec7a685a3106bad51612115f50b36eba74df8705d45b34e76dca70742d96e5f1041c1d3be6494dffff7f2002000000010000001f6baccbb2fb3fca335e387efb89b92bfc813500a3951fd3351a461e7e2de4730b34487c6b1ae1038e1fc181c63b1973b1103d42f7c6fb4857325a6bcaeac8f63ae6494dffff7f20030000000100000085b9ddb4af07102e4c509b888be0c13112898d4e286b21a85b51bec3fcdae330e6aab372d6287fddf1db2cc57728338cdedd67bf2918c887e5715ea411ee4a4839e6494dffff7f200000000001000000f0619ce3fddfdb4255c5dca7179f29bc91fd2fff929b264c229095fe7ad69a310eb6422c27adfd04f91b674e63c3c664d0039dd9d53f33ff5b16f8e0b5f1a9ff38e6494dffff7f2005000000010000000115fdc87e6d07e37736e9be2937f470ec5abe3e5a01a511e59ca600922aee170b16e0c889dbf2c589facf9979955e60e502867c85c7b9a4aed0d33a6822961737e6494dffff7f200000000001000000d909295550da9d33d2c6efe4d27bc96e5a03941f7a9126fbfa25c19c2027eb18b1d02469882cb3369a902df98b2b5c482c7b21228174bb3a7679c140c53aca7336e6494dffff7f200000000001000000315f02369d45d969b069c92c2d7e1da0df001874eb55f9b587eba6639d80742f65476eacfae3d53ea5b62e6232291dbff9fc7ca6e36c4414c8ac5dc1f2b4941935e6494dffff7f2003000000010000000d18e13308f34dc8e7d39ed799fca428f6809f7c357d3117446bf6e22d5a555df83d8241e718fa6281ece91aeee0617e0063201b677dde5374fb6bea9235d8cc34e6494dffff7f20000000000100000049dc082ef56a14be8079a2bda4cac92722e7cee615af843e3be02d7d84a1276a4b90f3d42582a68a8e84aa793511559b83d6c3ea325db810313038ed97df09c233e6494dffff7f20020000000100000021b130f957244f9ed255095ba9b0b9db795958d4b577bedd9af89b51edad96733b584fb59293d8fee15384b1210e8c335626b959fc159d378b401afbefaef3ef32e6494dffff7f20000000000100000095591aee1c8e17e598c04fb063c4ce7a8fad6bd144d69a3a9cd0c338239eac065d0fcba2ca3732271629ea7451b53f5d4a96f833c44cd8a3d5501e471f51ab7d31e6494dffff7f200000000001000000f73fc84cca40fd1c2e3ea1ceb285656eef8fdf4d2be403112371df45982aa867a2401461d25e22b26daeedfd81550e90c8a961029c1f97ca9f158a384ad7abbf30e6494dffff7f200200000001000000c6fb038c7c894172678af5ce2d470173d8549eee1247cf0e6af7fac62eb3e87672fb8c5f36cb53ca6702da7fe78a68e96de768b4915f796b3cef818c9e96a7ae2fe6494dffff7f200000000001000000b2ffb6c951849b237f1ab69baad11460dd459f53eb928d764c0eb13cc46a8870ff28d6681d41ccc1be736703a1dda81e44a5ce791046169772251f5dc581ee832ee6494dffff7f200100000001000000308e62fccf43020fa3a817311ec594b498ebeebb05c3a755aa096d7620df6e4a014190efad88bbfb72e64fd0126edeb6f81a1ecc1acd8c74a06d9124f68bd64d2de6494dffff7f20000000000100000082e2b08fe7834ea2bddc7e14fbb9ade58ba5f21147dd238c45ae7e9aba9f8b3700b5d285c9f55051aca41883db2a13d51c38cc4fe4e364ccf8909094c1e0b6232ce6494dffff7f20000000000100000089839656c6b2f78cd337418704c75ec84cc1c9b07e664d8ebaa89c8ca396813a955b535eff900431c5cdb1300b9132e7990d9e949125a40b66e29090432294862be6494dffff7f200000000001000000f7f58b3703ce29a5959d526fe6e23894406885f58bbd2a0adc3ed34aa1b60234dcdaf8696db794f808047f0dfe0f0403c86ceadc4947ee4f214fa628c76cdc4a2ae6494dffff7f200000000001000000f720406fc01048a3b126a93f8425fe15e2ed9df47c946b1f98f23bd78b39f84ef272629875927759891e8d1c6d5b8494eb1714d7dccc2f442dea3b540b78836a29e6494dffff7f200100000001000000d9d936b4cbcc773029b74dbf51f4f69dc5a17821bf18d9a57110b751b129a27977a910f2ace9bc5e06db0173585a2cca77258ad30d42881b4fcb1caed427545828e6494dffff7f2000000000010000004f9297187c38f3e6a62ca9a4bc672190ff8cc7a4b40f85bb14d6fc12ac489d419630d9a953fd360de5881c8bbfa408cc450ff2c96c7527c58e7ad7c62270ee53f0e5494dffff7f200000000001000000f03bf5e08e3b338194c0285d305242cd692f12052357a001039d41de8f11305d04a5449ed93fc7e1d385cef7f36ad579de85b915bc23f6874051c5707408febfefe5494dffff7f20000000000100000030c88c54f3935820cec5c86593c519b1f1219639a6b224d17e04369d26305c4caa4afb65e8bf7f6d818ee9c7652fdbd038ed67111b4ed5fe9c0166a0bcfc99bbeee5494dffff7f200000000001000000f0630be2a2d31490ade73ec876e942f86fb3e5cdfe58ff8e15e4f2555327ea17ea6ca5afa9315d8bb3cf58ac9ec32e349a647a7a985b3dac257767c459b99f0eede5494dffff7f200000000001000000be85a8731f49c29d6437c4d01f628a805c3b3848e8a78bb9234e8cefc7ff0a133893701bfa2d8079de56eb90a885ec5c8efefc4737f1c096f49601dff2cff6bfece5494dffff7f200000000001000000e63eac30865b24c3dfb76d530926307d6ad572bb3f97c547f252891313c8453461a195fe5c7e8114bee6f203cf7df138339e94139cda895370f1a9b064f6da99ebe5494dffff7f2000000000010000006c22f091579826cf2ecea3154bea60a26d1485d285cf3b56e0e3d0344e858d388b21fe1271608b6dca9d8c69f8b503a7fefb6e98b8f6a015b627349bee9aa6dfeae5494dffff7f200000000001000000dcdc43ba165c2baef6fb07800448d5181c783da2857da4780dc004c0edfd1c7d1d23e9f9304702e6e2b84cb35686c68e7daa05ec94fb1ff28dcb88d1a45a05f4e9e5494dffff7f200000000001000000eac6fc55edc56703447c7dfe09595309d8d00c7432ed1ca1b73efc5276a3f733bc1f95c3d9aae3966a4e60e5fff8160f7275418915724ab818e3ef9b51530561e8e5494dffff7f200200000001000000f4213c6f41ecf667f3af916602c28cd45af32a377d31c5fcafac0f79af2b73190e62ae0e49d97be9d45a7534411b5f4b4db0448af1ed4bd911f26511fbce3e2ce7e5494dffff7f200100000001000000ce51efefc2ce805b1cbcb39e02ecc31a9b39a39583ca273d0da64ee850989865b3b27f8c7a35ce92ed157f3ea9a648a6ec818736c441adbd20f4396c6bdb4c84e6e5494dffff7f20000000000100000099cd2a810e371f025b56982cbf0983f63f7f4fd0ac8964af407295a7e40e70311fb201733748656e19be3c52e06cb99ef000e9a6e2095ba946a126982e849767e5e5494dffff7f2002000000010000001f52f9a0fc889c3fedd500b40b9298a965a232aedf96463676f51038856d13338d04527dfd3123bd6da72da36b4e341f9785ce5ae75807b5269c56da81348ed4e4e5494dffff7f2003000000010000006e19c69f48639e9ec211d1a7d4577f6ef62bf0c7a90a7a73362df61f0bfa5335d052770beecb599038ec2c4f6b917d9f66904dc4eaa374f87c7427c61cce3b51e3e5494dffff7f2000000000010000002e4b6c56a4833877c897b84993612f435f3593d46bcc6508d5648f724b00736ee641ea29c3d2f02cff968081979566c80c6a3e389f1441422b88ae60d908ae9ae2e5494dffff7f2000000000010000003c65ae135ea43402b69ac5774ab263cce2ccdcc82ab312f4e6288319e376831f8d294b25f52a4a80b36711b40303ea90de59ee2f266859647fb1ba13ac046475e1e5494dffff7f200000000001000000a9173399d119d0851a5d99b8c3ea5de2ce243a3dfcc2658c6b2c72c62ee295549d319939f1dfa32027ec77b6614b60898a9580a64d1f8e56b8f0e2ad7b4be643e0e5494dffff7f2000000000010000008a128401c3d51e5af0c627b6ccbe94a0ead2388318ce9149374df8b9ccfd0736d650032988725f17c5969250fde4aa5658c25f591e9cfd7fe0257de7112267cedfe5494dffff7f2000000000010000001dbf68c40dff74fb3761e36cf79d53be5f2dd8d71d7c885bd3d9ef387a5f5e3b5572cd3be19133a65481a57a4259c98659a6489738b7fcff5c66efb1e50d9708dee5494dffff7f2001000000010000003dc5b90dc6af423b7dfc3702f748d08fcad04f5cceb3b063699d454ef319e74169417620318fc1b01ed7850407373a8763fa86ae16c110114cd631543cc2035fdde5494dffff7f200600000005013d01000000014f993ee9eb84c0fd6fd840756a341d0a7e0a87259c96e4a86de23cba6dbad1ab2800000000ffffffff012a50fe0000000000015100000000ef3a0024315a228a680f3a46fa75f3c6a7ad42de9881deb7f9d269c001a0d38e01008e6d1ddc1cc8881316cb997ecdda3adca0ebacbfb2877512f4eab3008aea6f3c"


    def "testing DsDetectMsg complete serializing"() {
        given:
            //config
        io.bitcoinsv.bsvcl.net.protocol.config.ProtocolConfig config = io.bitcoinsv.bsvcl.net.protocol.config.ProtocolConfigBuilder.get(new MainNetParams(Net.MAINNET))

        io.bitcoinsv.bsvcl.net.protocol.serialization.common.DeserializerContext deserializerContext = io.bitcoinsv.bsvcl.net.protocol.serialization.common.DeserializerContext.builder()
                    .protocolBasicConfig(config.getBasicConfig())
                    .build()
        io.bitcoinsv.bsvcl.net.protocol.serialization.common.SerializerContext serializerContext = io.bitcoinsv.bsvcl.net.protocol.serialization.common.SerializerContext.builder()
                .protocolBasicConfig(config.getBasicConfig())
                .build()

            //load serialized data into byte array
            ByteArrayReader reader = new ByteArrayReader(Hex.decode(SERIALIZED_DSDETECT_MSG))

            //we use to deserialize this msg
            io.bitcoinsv.bsvcl.net.protocol.serialization.DsDetectedMsgSerializer dsDetectedMsgSerializer = io.bitcoinsv.bsvcl.net.protocol.serialization.DsDetectedMsgSerializer.getInstance();

            //serialize back to this byte array for comparison
            ByteArrayWriter byteArrayWriter = new ByteArrayWriter()

        when:
            io.bitcoinsv.bsvcl.net.protocol.messages.DsDetectedMsg deserializedMsg = dsDetectedMsgSerializer.deserialize(deserializerContext, reader)

            dsDetectedMsgSerializer.serialize(serializerContext, deserializedMsg, byteArrayWriter)

        then:
            Hex.toHexString(byteArrayWriter.reader().getFullContent()) == SERIALIZED_DSDETECT_MSG// Do the serialize and deserialize output the same results?

            //check some last values to be deserialized within the object
            deserializedMsg.getBlockCount().getValue() == 5
            deserializedMsg.getBlockList().get(4).getHeaderCount().getValue() == 49
            Sha256Hash.wrap(deserializedMsg.getBlockList().get(4).getMerkleProofMsg().getNodes().get(0).getHash().getHashBytes()) == Sha256Hash.wrap("8e6d1ddc1cc8881316cb997ecdda3adca0ebacbfb2877512f4eab3008aea6f3c");
    }
}